{% extends "base.html" %}

{% block content %}
<div class="tb-upload-page">

  <!-- ìƒë‹¨ í—¤ë” -->
  <div class="tb-upload-header">
    <h1 class="tb-page-title">Track info</h1>
  </div>

  <form method="post" enctype="multipart/form-data" class="tb-upload-form">
    {% csrf_token %}

    {% if form.non_field_errors %}
      <div class="tb-form-errors">
        {{ form.non_field_errors }}
      </div>
    {% endif %}

    <!-- ğŸ”¥ ì™¼ìª½/ì˜¤ë¥¸ìª½ 2ì»¬ëŸ¼ ë ˆì´ì•„ì›ƒ -->
    <div class="tb-upload-layout">

      <!-- ì™¼ìª½: ì•„íŠ¸ì›Œí¬ -->
      <section class="tb-upload-left">
        <div class="tb-artwork-card"
          tabindex="-1"
          onclick="document.getElementById('id_music_thumbnail').click()">

      {# ğŸ”¥ í•­ìƒ ê°™ì€ êµ¬ì¡° ìœ ì§€: ìœ„ì— img í•˜ë‚˜, ë°‘ì— placeholder í•˜ë‚˜ #}
      <img
        id="tb-artwork-preview"
        class="tb-artwork-preview"
        alt="Artwork"
        src="{% if music and music.music_thumbnail %}{{ music.music_thumbnail.url }}{% endif %}"
        {% if not music or not music.music_thumbnail %}style="display:none;"{% endif %}
      >

      <div id="tb-artwork-placeholder"
          class="tb-artwork-placeholder"
          {% if music and music.music_thumbnail %}style="display:none;"{% endif %}>
        <div class="tb-artwork-icon">
          <svg width="48" height="48" viewBox="0 0 24 24"
              fill="none" stroke="#94a3b8" stroke-width="1.5"
              stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="3" width="18" height="18" rx="2"></rect>
            <circle cx="8.5" cy="8.5" r="1.5"></circle>
            <path d="M21 15l-5-5L5 21"></path>
          </svg>
        </div>
        <span class="tb-artwork-text">Add new artwork</span>
      </div>
    </div>

  {# ğŸ”¥ ì‹¤ì œ íŒŒì¼ inputì€ ìˆ¨ê²¨ë†“ê³  ì¹´ë“œ í´ë¦­ìœ¼ë¡œë§Œ ì‚¬ìš© #}
  {{ form.music_thumbnail }}

  {% if form.music_thumbnail.errors %}
    <div class="tb-field-error">
      {{ form.music_thumbnail.errors }}
    </div>
  {% endif %}
</section>


      <!-- ì˜¤ë¥¸ìª½: ì…ë ¥ í•„ë“œ ì „ì²´ -->
      <section class="tb-upload-right">

        <!-- Track title -->
        <div class="tb-field-row">
          <label class="tb-label">Track title</label>
          <div class="tb-field-main">
            {{ form.music_title }}
            {% if form.music_title.errors %}
              <div class="tb-field-error">
                {{ form.music_title.errors }}
              </div>
            {% endif %}
          </div>
        </div>

        <!-- Main artist -->
        <div class="tb-field-row">
          <label class="tb-label">Main artist</label>
          <div class="tb-field-main">
            {{ form.music_singer }}
            {% if form.music_singer.errors %}
              <div class="tb-field-error">
                {{ form.music_singer.errors }}
              </div>
            {% endif %}
            <p class="tb-help-text">
              ì—¬ëŸ¬ ëª…ì¼ ê²½ìš° ì‰¼í‘œë¡œ êµ¬ë¶„í•´ë„ ì¢‹ì•„ìš”.
            </p>
          </div>
        </div>

        <!-- Genre -->
        <div class="tb-field-row">
          <label class="tb-label">Genre</label>
          <div class="tb-field-main">
            {{ form.music_type }}
            {% if form.music_type.errors %}
              <div class="tb-field-error">
                {{ form.music_type.errors }}
              </div>
            {% endif %}
          </div>
        </div>

        <!-- Tags -->
        <div class="tb-field-row">
          <label class="tb-label">Tags</label>
          <div class="tb-field-main tb-tags-field">
            {{ form.tags }}
            {% if form.tags.errors %}
              <div class="tb-field-error">
                {{ form.tags.errors }}
              </div>
            {% endif %}
            <p class="tb-help-text">
              ë¶„ìœ„ê¸°, í…œí¬, ì‚¬ìš©ì²˜ ë“±ì— ë§ëŠ” íƒœê·¸ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.
            </p>
          </div>
        </div>

        <!-- Track privacy (UIë§Œ) -->
        <div class="tb-field-row">
          <label class="tb-label">Track privacy</label>
          <div class="tb-field-main tb-privacy-row">
            <label class="tb-radio-pill">
              <input type="radio" name="privacy" value="public" checked>
              <span>Public</span>
            </label>
            <label class="tb-radio-pill">
              <input type="radio" name="privacy" value="private">
              <span>Private</span>
            </label>
            <label class="tb-radio-pill">
              <input type="radio" name="privacy" value="schedule">
              <span>Schedule</span>
            </label>
          </div>
        </div>

      </section>

    </div>  <!-- /.tb-upload-layout -->

    <!-- í•˜ë‹¨ ë²„íŠ¼ -->
    <div class="tb-upload-footer">
      <a href="{% url 'twobeats_upload:music_list' %}" class="tb-upload-cancel">
        ì·¨ì†Œ
      </a>
      <button type="submit" class="tb-upload-submit">
        ì €ì¥ í›„ ì™„ë£Œ
      </button>
    </div>
  </form>
  
  <script>
    (function () {
      const input = document.getElementById('id_music_thumbnail');
      const img = document.getElementById('tb-artwork-preview');
      const placeholder = document.getElementById('tb-artwork-placeholder');

      if (!input || !img) return;

      input.addEventListener('change', function () {
        if (this.files && this.files[0]) {
          const file = this.files[0];
          const url = URL.createObjectURL(file);

          img.src = url;
          img.style.display = 'block';

          if (placeholder) {
            placeholder.style.display = 'none';
          }
        }
      });
    })();
  </script>

</div>
{% endblock %}
