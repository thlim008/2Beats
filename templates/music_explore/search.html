<!-- templates/music_explore/search.html -->

{% extends 'music_explore/base.html' %}

{% block title %}ìŒì•… ê²€ìƒ‰ - TwoBeats{% endblock %}

{% block content %}
<div class="card">
    <h1 style="margin-bottom: 1.5rem;">ğŸ” ìŒì•… ê²€ìƒ‰</h1>
    
    <!-- ê²€ìƒ‰ í¼ -->
    <form method="GET" action="{% url 'music_explore:search' %}">
        <!-- ì œëª©/ê°€ìˆ˜ ê²€ìƒ‰ -->
        <div style="margin-bottom: 1rem;">
            <input 
                type="text" 
                name="q" 
                class="search-box" 
                placeholder="ì œëª©, ê°€ìˆ˜ ê²€ìƒ‰..." 
                value="{{ query }}"
            >
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
            <!-- ì¥ë¥´ í•„í„° -->
            <select name="genre" class="search-box">
                <option value="">ì „ì²´ ì¥ë¥´</option>
                <option value="ballad" {% if genre == 'ballad' %}selected{% endif %}>ë°œë¼ë“œ</option>
                <option value="dance" {% if genre == 'dance' %}selected{% endif %}>ëŒ„ìŠ¤</option>
                <option value="hiphop" {% if genre == 'hiphop' %}selected{% endif %}>í™í•©</option>
                <option value="rnb" {% if genre == 'rnb' %}selected{% endif %}>R&B</option>
                <option value="rock" {% if genre == 'rock' %}selected{% endif %}>ë¡</option>
                <option value="pop" {% if genre == 'pop' %}selected{% endif %}>íŒ</option>
                <option value="indie" {% if genre == 'indie' %}selected{% endif %}>ì¸ë””</option>
                <option value="trot" {% if genre == 'trot' %}selected{% endif %}>íŠ¸ë¡œíŠ¸</option>
                <option value="jazz" {% if genre == 'jazz' %}selected{% endif %}>ì¬ì¦ˆ</option>
                <option value="ost" {% if genre == 'ost' %}selected{% endif %}>OST</option>
                <option value="etc" {% if genre == 'etc' %}selected{% endif %}>ê¸°íƒ€</option>
            </select>
            
            <!-- íƒœê·¸ í•„í„° (ë™ì !) -->
            <select name="tag" class="search-box">
                <option value="">ì „ì²´ íƒœê·¸</option>
                {% for t in all_tags %}
                    <option value="{{ t.name }}" {% if tag == t.name %}selected{% endif %}>
                        #{{ t.name }}
                    </option>
                {% endfor %}
            </select>
        </div>
        
        <button type="submit" class="btn btn-primary">ê²€ìƒ‰</button>
    </form>
</div>

<!-- ê²€ìƒ‰ ê²°ê³¼ -->
<div class="card">
    <h2 style="margin-bottom: 1rem;">
        {% if query or genre or tag %}
            ê²€ìƒ‰ ê²°ê³¼ ({{ musics.count }}ê³¡)
            {% if query %}<span style="color: #1db954;"> - "{{ query }}"</span>{% endif %}
            {% if genre %}<span style="color: #1db954;"> - ì¥ë¥´: {{ genre }}</span>{% endif %}
            {% if tag %}<span style="color: #1db954;"> - íƒœê·¸: #{{ tag }}</span>{% endif %}
        {% else %}
            ì „ì²´ ìŒì•… ({{ musics.count }}ê³¡)
        {% endif %}
    </h2>
    
    {% if musics %}
        <div style="display: grid; gap: 1rem;">
            {% for music in musics %}
                <div style="
                    padding: 1rem; 
                    border: 1px solid #eee; 
                    border-radius: 8px;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    transition: all 0.3s;
                " onmouseover="this.style.backgroundColor='#f9f9f9'" 
                   onmouseout="this.style.backgroundColor='white'">
                    <div>
                        <h3 style="margin-bottom: 0.5rem;">
                            <a href="{% url 'music_explore:detail' music.id %}" 
                               style="color: #333; text-decoration: none;">
                                {{ music.music_title }}
                            </a>
                        </h3>
                        <p style="color: #666;">{{ music.music_singer }}</p>
                        <p style="color: #999; font-size: 0.9rem;">
                            {{ music.get_music_type_display }} | 
                            ì¬ìƒ {{ music.music_count }}íšŒ | 
                            ì¢‹ì•„ìš” {{ music.music_like_count }}
                            
                            <!-- íƒœê·¸ í‘œì‹œ -->
                            {% if music.tags.all %}
                                | 
                                {% for mtag in music.tags.all %}
                                    <span style="color: #1db954;">#{{ mtag.name }}</span>{% if not forloop.last %}, {% endif %}
                                {% endfor %}
                            {% endif %}
                        </p>
                    </div>
                    <a href="{% url 'music_explore:detail' music.id %}" class="btn btn-primary">
                        ì¬ìƒ â–¶
                    </a>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p style="text-align: center; color: #999; padding: 2rem;">
            ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.
        </p>
    {% endif %}
</div>
{% endblock %}