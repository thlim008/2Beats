<!--
  ========================================
  ì˜ìƒ ëª©ë¡ í˜ì´ì§€ (Video List)
  ========================================
  - ì˜ìƒ ê²€ìƒ‰ ë° í•„í„°ë§
  - ì¸ê¸° ì˜ìƒ TOP3 í‘œì‹œ
  - ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒìœ¼ë¡œ ì˜ìƒ ëª©ë¡ í‘œì‹œ
  - í˜ì´ì§€ë„¤ì´ì…˜
-->

{% extends "base.html" %}
{% block title %}ì˜ìƒ - 2Beats{% endblock %}

{% block extra_head %}
<style>
  /* ========================================
     ì»¨í…Œì´ë„ˆ
     ======================================== */
  .video-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px 20px 20px;
  }

  /* ========================================
     ê²€ìƒ‰ ë° í•„í„° ì˜ì—­
     ======================================== */
  .search-box {
    margin: 20px 0;
    display: flex;
    gap: 10px;
    position: relative;
  }

  .search-box input {
    flex: 1;
    padding: 12px 20px;
    border: 2px solid rgba(255,255,255,0.15);
    background: rgba(255,255,255,0.05);
    border-radius: 25px;
    font-size: 14px;
    color: white;
    transition: all 0.2s;
  }

  .search-box input::placeholder {
    color: rgba(255,255,255,0.4);
  }

  .search-box input:focus {
    outline: none;
    border-color: #c084fc;
    background: rgba(255,255,255,0.08);
    box-shadow: 0 0 0 3px rgba(192,132,252,0.15);
  }

  .search-box button {
    padding: 12px 30px;
    background: linear-gradient(120deg, #c084fc, #7c3aed);
    color: white;
    border: none;
    border-radius: 25px;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.3s;
    box-shadow: 0 4px 12px rgba(124,58,237,0.3);
  }

  .search-box button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(124,58,237,0.4);
  }

  /* í•„í„° ì„ íƒ ì˜ì—­ */
  .filter-row {
    margin: 20px 0;
    display: flex;
    gap: 10px;
  }

  .filter-row select {
    flex: 1;
    padding: 10px 15px;
    border: 2px solid rgba(255,255,255,0.15);
    background: rgba(255,255,255,0.05);
    border-radius: 8px;
    font-size: 14px;
    cursor: pointer;
    color: white;
    transition: all 0.2s;
  }

  .filter-row select option {
    background: #120f1f;
    color: white;
  }

  .filter-row select:focus {
    outline: none;
    border-color: #c084fc;
    background: rgba(255,255,255,0.08);
  }

  /* ========================================
     ì˜ìƒ ê·¸ë¦¬ë“œ
     ======================================== */
  .video-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 20px;
    margin: 30px 0;
  }

  .video-card {
    background: rgba(255,255,255,0.04);
    backdrop-filter: blur(8px);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 12px;
    overflow: hidden;
    cursor: pointer;
    transition: all 0.3s;
    text-decoration: none;
    color: inherit;
    display: block;
  }

  .video-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 20px rgba(192,132,252,0.25);
    border-color: rgba(192,132,252,0.3);
  }

  .video-card .thumbnail-wrapper {
    position: relative;
    padding-bottom: 56.25%;
    background: #000;
  }

  .video-card .thumbnail {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .video-card .duration {
    position: absolute;
    bottom: 8px;
    right: 8px;
    background: rgba(0,0,0,0.85);
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 500;
  }

  .video-card .info {
    padding: 12px;
    background: linear-gradient(to top, rgba(18,15,31,0.8), transparent);
  }

  .video-card .title {
    font-size: 14px;
    font-weight: bold;
    margin-bottom: 6px;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    color: white;
  }

  .video-card .singer {
    color: #c084fc;
    font-size: 13px;
    margin-bottom: 6px;
  }

  .video-card .views {
    color: rgba(255,255,255,0.5);
    font-size: 12px;
  }

  .video-card .tags {
    display: flex;
    flex-wrap: wrap;
    gap: 5px;
    margin-top: 8px;
  }

  .video-card .tag {
    display: inline-block;
    padding: 3px 8px;
    background: rgba(192,132,252,0.12);
    color: rgba(192,132,252,0.9);
    border-radius: 10px;
    font-size: 11px;
  }

  /* ========================================
     í˜ì´ì§€ë„¤ì´ì…˜
     ======================================== */
  .pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    margin: 40px 0;
  }

  .pagination a,
  .pagination span {
    padding: 8px 12px;
    border: 1px solid rgba(255,255,255,0.15);
    background: rgba(255,255,255,0.05);
    border-radius: 8px;
    text-decoration: none;
    color: rgba(255,255,255,0.7);
    transition: all 0.2s;
  }

  .pagination a:hover {
    background: rgba(192,132,252,0.15);
    color: white;
    border-color: rgba(192,132,252,0.4);
  }

  .pagination .current {
    background: linear-gradient(120deg, #c084fc, #7c3aed);
    color: white;
    border-color: transparent;
    font-weight: bold;
  }

  /* ========================================
     í˜ì´ì§€ í—¤ë”
     ======================================== */
  .page-header {
    margin-top: -1.5rem;
    margin-bottom: 1.5rem;
  }

  .page-header h1 {
    font-size: 1.8rem;
    font-weight: 700;
    color: white;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  /* ë¹ˆ ìƒíƒœ */
  .empty-state {
    text-align: center;
    padding: 60px 20px;
    color: rgba(255,255,255,0.5);
  }

  .empty-state p {
    font-size: 18px;
  }

  /* ========================================
     ë°˜ì‘í˜• ë””ìì¸
     ======================================== */
  @media (max-width: 1024px) {
    .video-grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  @media (max-width: 768px) {
    .top3-container {
      grid-template-columns: 1fr;
    }

    .video-grid {
      grid-template-columns: repeat(2, 1fr);
    }

    .filter-row {
      flex-direction: column;
    }
  }

  @media (max-width: 480px) {
    .video-grid {
      grid-template-columns: 1fr;
    }
  }
</style>
{% endblock %}

{% block content %}
<div class="video-container">
  <!-- ========================================
       í˜ì´ì§€ í—¤ë”
       ======================================== -->
  <div class="page-header">
    <h1>ğŸ¬ ì˜ìƒ ê²€ìƒ‰</h1>
  </div>

  <!-- ========================================
       ê²€ìƒ‰ ë° í•„í„°
       ======================================== -->
  <form id="search-form" method="get" action="{% url 'video_explore:video_list' %}">
    <!-- ê²€ìƒ‰ì°½ -->
    <div class="search-box">
      <input
        id="search-input"
        type="text"
        name="q"
        placeholder="ì˜ìƒ ì œëª©ì´ë‚˜ ì•„í‹°ìŠ¤íŠ¸ë¥¼ ê²€ìƒ‰í•˜ì„¸ìš”..."
        value="{{ search_query }}"
        autocomplete="off"
      >
      <button type="submit">ê²€ìƒ‰</button>
      <div id="autocomplete-dropdown" class="autocomplete-dropdown"></div>
    </div>

    <!-- í•„í„° -->
    <div class="filter-row">
      <select name="type" id="video-type-select">
        <option value="" {% if not current_type %}selected{% endif %}>ì¥ë¥´: ì „ì²´</option>
        {% for type_code, type_name in video_types %}
        <option value="{{ type_code }}" {% if current_type == type_code %}selected{% endif %}>ì¥ë¥´: {{ type_name }}</option>
        {% endfor %}
      </select>

      <select name="tag" id="tag-select">
        <option value="" {% if not selected_tag %}selected{% endif %}>íƒœê·¸: ì „ì²´</option>
        {% for tag in all_tags %}
        <option value="{{ tag.name }}" {% if selected_tag == tag.name %}selected{% endif %}>íƒœê·¸: #{{ tag.name }}</option>
        {% endfor %}
      </select>
    </div>
  </form>

  {% if search_query %}
  <p style="color: rgba(255,255,255,0.6); margin: 10px 0;">
    '<strong>{{ search_query }}</strong>' ê²€ìƒ‰ ê²°ê³¼: {{ page_obj.paginator.count }}ê°œ
  </p>
  {% endif %}

  <!-- ========================================
       ì˜ìƒ ë¦¬ìŠ¤íŠ¸
       ======================================== -->
  {% if videos %}
  <div class="video-grid">
    {% for video in videos %}
    <a href="{% url 'video_explore:video_detail' video.pk %}" class="video-card">
      <div class="thumbnail-wrapper">
        {% if video.video_thumbnail %}
        <img src="{{ video.video_thumbnail.url }}" alt="{{ video.video_title }}" class="thumbnail">
        {% else %}
        <img src="https://via.placeholder.com/400x225?text=No+Thumbnail" alt="No Thumbnail" class="thumbnail">
        {% endif %}
        {% if video.video_time %}
        <div class="duration">
          {% widthratio video.video_time 60 1 %}:{% widthratio video.video_time 60 1 as minutes %}{{ video.video_time|add:"-"|add:minutes|stringformat:"02d" }}
        </div>
        {% endif %}
      </div>
      <div class="info">
        <div class="title">{{ video.video_title }}</div>
        <div class="singer">{{ video.video_singer }}</div>
        <div class="views">ì¡°íšŒìˆ˜ {{ video.video_views|default:0 }} | ì¢‹ì•„ìš” {{ video.video_like_count|default:0 }}</div>
        {% if video.tags.all %}
        <div class="tags">
          {% for tag in video.tags.all|slice:":3" %}
          <span class="tag">#{{ tag.name }}</span>
          {% endfor %}
        </div>
        {% endif %}
      </div>
    </a>
    {% endfor %}
  </div>

  <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
  {% if page_obj.has_other_pages %}
  <div class="pagination">
    {% if page_obj.has_previous %}
    <a href="?page=1{% if search_query %}&q={{ search_query }}{% endif %}{% if current_type %}&type={{ current_type }}{% endif %}{% if selected_tag %}&tag={{ selected_tag }}{% endif %}">ì²˜ìŒ</a>
    <a href="?page={{ page_obj.previous_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}{% if current_type %}&type={{ current_type }}{% endif %}{% if selected_tag %}&tag={{ selected_tag }}{% endif %}">ì´ì „</a>
    {% endif %}

    {% for num in page_obj.paginator.page_range %}
      {% if page_obj.number == num %}
      <span class="current">{{ num }}</span>
      {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
      <a href="?page={{ num }}{% if search_query %}&q={{ search_query }}{% endif %}{% if current_type %}&type={{ current_type }}{% endif %}{% if selected_tag %}&tag={{ selected_tag }}{% endif %}">{{ num }}</a>
      {% endif %}
    {% endfor %}

    {% if page_obj.has_next %}
    <a href="?page={{ page_obj.next_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}{% if current_type %}&type={{ current_type }}{% endif %}{% if selected_tag %}&tag={{ selected_tag }}{% endif %}">ë‹¤ìŒ</a>
    <a href="?page={{ page_obj.paginator.num_pages }}{% if search_query %}&q={{ search_query }}{% endif %}{% if current_type %}&type={{ current_type }}{% endif %}{% if selected_tag %}&tag={{ selected_tag }}{% endif %}">ë§ˆì§€ë§‰</a>
    {% endif %}
  </div>
  {% endif %}

  {% else %}
  <div class="empty-state">
    <p>ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤.</p>
  </div>
  {% endif %}
</div>

<!-- ê²€ìƒ‰ ìë™ì™„ì„± -->
{% include 'video_explore/search_autocomplete.html' %}
{% endblock %}
